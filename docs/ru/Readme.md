# 📦 Моделирование твёрдых тел на графических процессорах

## 🌐 Переводы

| Язык  | Ссылка |
|---|---|
| 🇷🇺 Русский  | [Readme.md](Readme.md) |
| 🇬🇧 English | [Readme.md](../../Readme.md) |

---

## Симуляция

Загрузка гифки... может занять несколько секунд ⏳  
![Поток падающих тел](../content/Result_1.gif)  
![Пирамида из тел](../content/Screen_2.png)  
[Смотреть демо (скачать mp4)](https://github.com/Bletraut/RigidBodySimulationOnGpuDX/raw/refs/heads/master/docs/content/Simulation.mp4)  

## Описание проекта

Проект представляет собой симуляцию твёрдых тел, реализованную с использованием **MonoGame** и **GPU вычислений**.  
Данная симуляция основана на главе 29 из книги Gpu Gems 3: [Chapter 29. Real-Time Rigid Body Simulation on GPUs](https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-29-real-time-rigid-body-simulation-gpus), поэтому основной целью проекта было воссоздать методы используемые в данной статье и разобраться в принципах их работы.  

В проекте были использованы следующие 3D модели: [Low Poly Food Pack by Felipe Greboge](https://greboge.itch.io/low-poly-food-pack)

### Особенности:
✅ Поддержка твёрдых тел, состоящих из частиц  
✅ Моделирование упругих столкновений  
✅ Моделирование трения и вязкого демпфирования  
✅ Симуляция выполняется на GPU для высокой производительности  

---

## 🚀 Как это работает?

Более подробное объяснение с описанием шейдеров и используемых техник можно найти [здесь](./HowItWorks.md).

Система состоит из набора тел, каждое из которых — это набор частиц. Движение рассчитывается с учётом сил упругости, демпфирования и трения. Каждое тело имеет:

- Центр масс
- Линейную скорость
- Угловую скорость
- Тензор инерции

Силы рассчитываются на уровне частиц, а затем агрегируются в силы и моменты для всего тела.

---

## 📂 Структура проекта

Описание основных классов представлено ниже

```
├── RigidBodySimulationOnGpuDX/
│   ├── Simulation/
│   │	├── ParticleShapeCreator.cs		# Класс превращающий 3d модель в набор частиц
│   │	├── PhysicsOnGpuSolver.cs			# Класс который рассчитывает симуляцию
│   │	├── PhysicsOnGpuSolver.Simulation.cs	# Логика симуляции (переключение шейдеров и т.д.)
│   │	├── PhysicsOnGpuSolver.Body.cs		# Логика добавления тел
│   │	└── PhysicsOnGpuSolver.Render.cs		# Рендер симуляции
│   ├── Program.cs				# Точка входа в программу
│   └── Simulation.cs				# Точка входа в симуляцию
│
└── Content/Effects/
	├── DepthPeeling.fx			# Определение позиций частиц для генерация формы
	├── ParticleValues.fx			# Расчёт относительных позиций и сил для частиц
	├── GridGeneration.fx			# Генерация сетки для оптимизации столкновений
	├── CollisionReaction.fx		# Расчёт реакций на столкновения 
	├── BodiesValue.fx			# Расчет позиций и импульсов для твёрдых тел
	├── ParticleDebugRender.fx		# Рендер частиц (используется для отладки)
	├── SimulationRender.fx		# Рендер тел
	└── Skybox.fx				# Простейший шейдер для скайбокса

```

---

## 🛠️ Используемые технологии

Данный проект работает на [MonoGame](https://monogame.net/) используя DirectX, по этому он точно запустится на Windows, но скорее всего не будет работать на Mac и Linux (я не проверял).

- .Net Core 8
- [MonoGame](https://monogame.net/)
- HLSL для шейдеров
- C# для логики симуляции

Для отладки шейдеров я использовал [RenderDoc](https://github.com/baldurk/renderdoc).

---

## 📖 Как запустить

1. Склонируйте репозиторий.
2. Установите .NET 8 SDK
3. Откройте решение в Visual Studio или Rider, Monogame должен установиться через Nuget автоматически.
4. Запустите проект.
